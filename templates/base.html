<!doctype html>
<html lang="nl">
<head>
  <!-- Google tag (gtag.js) -->
  {% if GA_ID %}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ GA_ID }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ GA_ID }}');
  </script>
  {% endif %}

  <meta charset="utf-8">
  <title>{% block title %}TrendWatcher{% endblock %}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="theme-{{ theme|default('newspaper') }}">
  {% include "partials/navbar.html" %}

  <main class="tw-container">
    <section class="tw-main">
      {% block content %}{% endblock %}
    </section>
    <aside class="tw-aside">
      {% block sidebar %}{% endblock %}
    </aside>
  </main>

  {% include "partials/footer.html" %}

  <!-- AJAX Refresh Functionality -->
  <script>
    /**
     * Refresh data voor een specifieke category
     * @param {string} category - crypto, stocks, entertainment, sports, ecommerce
     * @param {string} containerId - ID van container om bij te werken
     */
    function refreshData(category, containerId) {
      const button = event.target;
      const originalText = button.textContent;

      // Toon loading state
      button.textContent = 'Refreshing...';
      button.disabled = true;

      // Haal fresh data op via JSON API
      fetch(`/api/${category}/trending`)
        .then(response => response.json())
        .then(result => {
          if (result.success && result.data) {
            // Reload pagina om nieuwe data te tonen (simpelste oplossing)
            location.reload();
          } else {
            alert('Error refreshing data: ' + (result.error || 'Unknown error'));
            button.textContent = originalText;
            button.disabled = false;
          }
        })
        .catch(error => {
          console.error('Refresh error:', error);
          alert('Network error while refreshing');
          button.textContent = originalText;
          button.disabled = false;
        });
    }

    /**
     * Auto-refresh timer - refresh data elke N minuten
     * @param {number} minutes - Aantal minuten tussen refreshes
     */
    function startAutoRefresh(minutes) {
      const milliseconds = minutes * 60 * 1000;
      setInterval(() => {
        const currentPath = window.location.pathname;
        const category = currentPath.substring(1); // Remove leading /

        if (category && category !== '') {
          console.log(`Auto-refreshing ${category} data...`);
          location.reload();
        }
      }, milliseconds);
    }

    // Optional: Start auto-refresh elke 5 minuten
    // startAutoRefresh(5);
  </script>
</body>
</html>
